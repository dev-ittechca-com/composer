{"version":3,"file":"database/multi_table_query.js","mappings":"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","sources":["webpack://phpmyadmin/./resources/js/src/database/multi_table_query.ts","webpack://phpmyadmin/external var \"jQuery\""],"sourcesContent":["import $ from 'jquery';\nimport { AJAX } from '../modules/ajax.ts';\nimport { getSqlEditor } from '../modules/functions.ts';\nimport { CommonParams } from '../modules/common.ts';\nimport { ajaxShowMessage } from '../modules/ajax-message.ts';\nimport { escapeBacktick } from '../modules/functions/escape.ts';\n/**\n * @fileoverview    function used in QBE for DB\n * @name            Database Operations\n *\n * @requires    jQueryUI\n * @requires    js/database/query_generator.js\n */\n/**\n * js file for handling AJAX and other events in /database/multi-table-query\n */\n/**\n * Unbind all event handlers before tearing down a page\n */\nAJAX.registerTeardown('database/multi_table_query.js', function () {\n    $('.tableNameSelect').each(function () {\n        $(this).off('change');\n    });\n    $('.columnNameSelect').each(function () {\n        $(this).off('change');\n    });\n    $('.criteria_op').each(function () {\n        $(this).off('change');\n    });\n    $('#update_query_button').off('click');\n    $('#add_column_button').off('click');\n    $('body').off('click', 'input.add-option');\n    $('body').off('click', 'input.remove-option');\n});\nAJAX.registerOnload('database/multi_table_query.js', function () {\n    var editor = getSqlEditor($('#MultiSqlquery'), {}, 'vertical');\n    $('.CodeMirror-line').css('text-align', 'left');\n    editor.setSize(-1, 50);\n    var columnCount = 3;\n    addNewColumnCallbacks();\n    function opsWithMultipleArgs() {\n        return ['IN (...)', 'NOT IN (...)'];\n    }\n    $('#update_query_button').on('click', function () {\n        var columns = [];\n        var tableAliases = {};\n        $('.tableNameSelect').each(function () {\n            var $show = $(this).siblings('.show_col').first();\n            if ($(this).val() !== '' && $show.prop('checked')) {\n                var tableAlias = $(this).siblings('.table_alias').first().val();\n                var columnAlias = $(this).siblings('.col_alias').first().val();\n                if (tableAlias !== '') {\n                    columns.push([tableAlias, $(this).siblings('.columnNameSelect').first().val()]);\n                }\n                else {\n                    columns.push([$(this).val(), $(this).siblings('.columnNameSelect').first().val()]);\n                }\n                columns[columns.length - 1].push(columnAlias);\n                if ($(this).val() in tableAliases) {\n                    if (!(tableAliases[$(this).val()].includes(tableAlias))) {\n                        tableAliases[$(this).val()].push(tableAlias);\n                    }\n                }\n                else {\n                    tableAliases[$(this).val()] = [tableAlias];\n                }\n            }\n        });\n        if (Object.keys(tableAliases).length === 0) {\n            ajaxShowMessage('Nothing selected', false, 'error');\n            return;\n        }\n        var foreignKeys;\n        $.ajax({\n            type: 'GET',\n            async: false,\n            url: 'index.php?route=/database/multi-table-query/tables',\n            data: {\n                'server': sessionStorage.server,\n                'db': $('#db_name').val(),\n                'tables': Object.keys(tableAliases),\n                'ajax_request': '1',\n                'token': CommonParams.get('token')\n            },\n            success: function (response) {\n                foreignKeys = response.foreignKeyConstrains;\n            }\n        });\n        var query = 'SELECT ' + '`' + escapeBacktick(columns[0][0]) + '`.';\n        if (columns[0][1] === '*') {\n            query += '*';\n        }\n        else {\n            query += '`' + escapeBacktick(columns[0][1]) + '`';\n        }\n        if (columns[0][2] !== '') {\n            query += ' AS `' + escapeBacktick(columns[0][2]) + '`';\n        }\n        for (var i = 1; i < columns.length; i++) {\n            query += ', `' + escapeBacktick(columns[i][0]) + '`.';\n            if (columns[i][1] === '*') {\n                query += '*';\n            }\n            else {\n                query += '`' + escapeBacktick(columns[i][1]) + '`';\n            }\n            if (columns[i][2] !== '') {\n                query += ' AS `' + escapeBacktick(columns[i][2]) + '`';\n            }\n        }\n        query += '\\nFROM ';\n        query += window.generateFromBlock(tableAliases, foreignKeys);\n        var $criteriaColCount = $('.criteria_col:checked').length;\n        if ($criteriaColCount > 0) {\n            query += '\\nWHERE ';\n            query += window.generateWhereBlock();\n        }\n        query += ';';\n        editor.getDoc().setValue(query);\n    });\n    $('#submit_query').on('click', function () {\n        var query = editor.getDoc().getValue();\n        // Verifying that the query is not empty\n        if (query === '') {\n            ajaxShowMessage(window.Messages.strEmptyQuery, false, 'error');\n            return;\n        }\n        var data = {\n            'db': $('#db_name').val(),\n            'sql_query': query,\n            'ajax_request': '1',\n            'server': CommonParams.get('server'),\n            'token': CommonParams.get('token')\n        };\n        $.ajax({\n            type: 'POST',\n            url: 'index.php?route=/database/multi-table-query/query',\n            data: data,\n            success: function (data) {\n                var $resultsDom = $(data.message);\n                $resultsDom.find('.ajax:not(.pageselector)').each(function () {\n                    $(this).on('click', function (event) {\n                        event.preventDefault();\n                    });\n                });\n                $resultsDom.find('.autosubmit, .pageselector, .showAllRows, .filter_rows').each(function () {\n                    $(this).on('change click select focus', function (event) {\n                        event.preventDefault();\n                    });\n                });\n                // @ts-ignore\n                $('#sql_results').html($resultsDom);\n                $('#slide-handle').trigger('click'); // Collapse search criteria area\n            }\n        });\n    });\n    $('#add_column_button').on('click', function () {\n        columnCount++;\n        var $newColumnDom = $('<div class=\"col\"></div>').html($('#new_column_layout').html());\n        $newColumnDom.find('.jsCriteriaButton').first().attr('data-bs-target', '#criteriaOptionsExtra' + columnCount.toString());\n        $newColumnDom.find('.jsCriteriaButton').first().attr('aria-controls', 'criteriaOptionsExtra' + columnCount.toString());\n        $newColumnDom.find('.jsCriteriaOptions').first().attr('id', 'criteriaOptionsExtra' + columnCount.toString());\n        $('#add_column_button').parent().siblings('.row').append($newColumnDom);\n        addNewColumnCallbacks();\n    });\n    $('.columnNameSelect').each(function () {\n        $(this).on('change', function () {\n            const colIsStar = $(this).val() === '*';\n            colIsStar && $(this).siblings('.col_alias').val('');\n            $(this).siblings('.col_alias').prop('disabled', colIsStar);\n        });\n    });\n    const acceptsMultipleArgs = opsWithMultipleArgs();\n    $('.criteria_op').each(function () {\n        $(this).on('change', function () {\n            if (acceptsMultipleArgs.includes($(this).val().toString())) {\n                showMultiFields($(this));\n            }\n            else {\n                const options = $(this).closest('table').find('.options');\n                options.parent().prepend('<input type=\"text\" class=\"rhs_text_val query-form__input--wide\" placeholder=\"Enter criteria as free text\"></input>');\n                options.remove();\n            }\n        });\n    });\n    function showMultiFields(opSelect) {\n        const criteriaInput = opSelect.closest('table').find('.rhs_text_val');\n        const criteriaInputCol = criteriaInput.parent();\n        const hasAtLeastOneOption = criteriaInputCol.find('.option').length > 0;\n        if (!hasAtLeastOneOption) {\n            criteriaInputCol.append(`\n                <div class=\"options\">\n                    <div class=\"option\">\n                        <input type=\"text\" class=\"val\" placeholder=\"Enter an option\" value=\"${criteriaInput.val()}\" />\n                        <input type=\"button\" class=\"btn btn-secondary add-option\" value=\"+\" />\n                    </div>\n                </div>\n            `);\n        }\n        criteriaInput.remove();\n    }\n    $('body').on('click', 'input.add-option', function () {\n        const options = $(this).closest('.options');\n        options.find('.option').first().clone().appendTo(options);\n        const newAdded = options.find('.option').last();\n        newAdded.find('input.val').val('');\n        newAdded.append('<input type=\"button\" class=\"btn btn-secondary remove-option\" value=\"-\" />');\n    });\n    $('body').on('click', 'input.remove-option', function () {\n        $(this).closest('.option').remove();\n    });\n    function addNewColumnCallbacks() {\n        $('.tableNameSelect').each(function () {\n            $(this).on('change', function () {\n                const $table = $(this);\n                const $alias = $table.siblings('.col_alias');\n                const $colsSelect = $table.parent().find('.columnNameSelect');\n                $alias.prop('disabled', true);\n                $colsSelect.each(function () {\n                    $(this).show();\n                    $(this).first().html($('#' + $table.find(':selected').data('hash')).html());\n                    if ($(this).hasClass('opColumn')) {\n                        $(this).find('option[value=\"*\"]').remove();\n                    }\n                });\n            });\n        });\n        $('.jsRemoveColumn').each(function () {\n            $(this).on('click', function () {\n                $(this).parent().parent().parent().remove();\n            });\n        });\n        $('.jsCriteriaButton').each(function () {\n            $(this).on('click', function (event, from) {\n                if (from === null) {\n                    var $checkbox = $(this).siblings('.criteria_col').first();\n                    $checkbox.prop('checked', !$checkbox.prop('checked'));\n                }\n                var $criteriaColCount = $('.criteria_col:checked').length;\n                if ($criteriaColCount > 1) {\n                    $(this).siblings('.jsCriteriaOptions').first().find('.logical_operator').first().css('display', 'table-row');\n                }\n            });\n        });\n        $('.criteria_col').each(function () {\n            $(this).on('change', function () {\n                var $anchor = $(this).siblings('.jsCriteriaButton').first();\n                if (($(this).is(':checked') && !$anchor.hasClass('collapsed'))\n                    || (!$(this).is(':checked') && $anchor.hasClass('collapsed'))) {\n                    // Do not collapse on checkbox tick as it does not make sense\n                    // The user has it open and wants to tick the box\n                    return;\n                }\n                $anchor.trigger('click', ['Trigger']);\n            });\n        });\n        $('.criteria_rhs').each(function () {\n            $(this).on('change', function () {\n                var $rhsCol = $(this).parent().parent().siblings('.rhs_table').first();\n                var $rhsText = $(this).parent().parent().siblings('.rhs_text').first();\n                if ($(this).val() === 'text') {\n                    $rhsCol.css('display', 'none');\n                    $rhsText.css('display', 'table-row');\n                }\n                else if ($(this).val() === 'anotherColumn') {\n                    $rhsText.css('display', 'none');\n                    $rhsCol.css('display', 'table-row');\n                }\n                else {\n                    $rhsText.css('display', 'none');\n                    $rhsCol.css('display', 'none');\n                }\n            });\n        });\n    }\n});\n","module.exports = jQuery;"],"names":["$","AJAX","getSqlEditor","CommonParams","ajaxShowMessage","escapeBacktick","registerTeardown","each","off","registerOnload","editor","css","setSize","columnCount","addNewColumnCallbacks","opsWithMultipleArgs","on","columns","tableAliases","$show","siblings","first","val","prop","tableAlias","columnAlias","push","length","includes","Object","keys","foreignKeys","ajax","type","async","url","data","sessionStorage","server","get","success","response","foreignKeyConstrains","query","i","window","generateFromBlock","$criteriaColCount","generateWhereBlock","getDoc","setValue","getValue","Messages","strEmptyQuery","$resultsDom","message","find","event","preventDefault","html","trigger","$newColumnDom","attr","toString","parent","append","colIsStar","acceptsMultipleArgs","showMultiFields","options","closest","prepend","remove","opSelect","criteriaInput","criteriaInputCol","hasAtLeastOneOption","concat","clone","appendTo","newAdded","last","$table","$alias","$colsSelect","show","hasClass","from","$checkbox","$anchor","is","$rhsCol","$rhsText"],"sourceRoot":""}