{"version":3,"file":"server/databases.js","mappings":"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","sources":["webpack://phpmyadmin/external var \"jQuery\"","webpack://phpmyadmin/./js/src/server/databases.js"],"sourcesContent":["module.exports = jQuery;","import $ from 'jquery';\nimport { AJAX } from '../modules/ajax.js';\nimport { Functions } from '../modules/functions.js';\nimport { Navigation } from '../modules/navigation.js';\nimport { CommonParams } from '../modules/common.js';\nimport { ajaxShowMessage } from '../modules/ajax-message.js';\nimport getJsConfirmCommonParam from '../modules/functions/getJsConfirmCommonParam.js';\nimport { escapeHtml } from '../modules/functions/escape.js';\nimport refreshMainContent from '../modules/functions/refreshMainContent.js';\n\n/**\n * @see https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener\n */\nconst DropDatabases = {\n    /**\n     * @param {Event} event\n     */\n    handleEvent: function (event) {\n        event.preventDefault();\n\n        var $form = $(this);\n\n        /**\n         * @var selected_dbs Array containing the names of the checked databases\n         */\n        var selectedDbs = [];\n        // loop over all checked checkboxes, except the .checkall_box checkbox\n        $form.find('input:checkbox:checked:not(.checkall_box)').each(function () {\n            $(this).closest('tr').addClass('removeMe');\n            selectedDbs[selectedDbs.length] = 'DROP DATABASE `' + escapeHtml($(this).val()) + '`;';\n        });\n        if (! selectedDbs.length) {\n            ajaxShowMessage(\n                $('<div class=\"alert alert-warning\" role=\"alert\"></div>').text(\n                    window.Messages.strNoDatabasesSelected\n                ),\n                2000\n            );\n            return;\n        }\n        /**\n         * @var question    String containing the question to be asked for confirmation\n         */\n        var question = window.Messages.strDropDatabaseStrongWarning + ' ' +\n            window.sprintf(window.Messages.strDoYouReally, selectedDbs.join('<br>'));\n\n        const modal = $('#dropDatabaseModal');\n        modal.find('.modal-body').html(question);\n        modal.modal('show');\n\n        const url = 'index.php?route=/server/databases/destroy&' + $(this).serialize();\n\n        $('#dropDatabaseModalDropButton').on('click', function () {\n            ajaxShowMessage(window.Messages.strProcessingRequest, false);\n\n            var parts = url.split('?');\n            var params = getJsConfirmCommonParam(this, parts[1]);\n\n            $.post(parts[0], params, function (data) {\n                if (typeof data !== 'undefined' && data.success === true) {\n                    ajaxShowMessage(data.message);\n\n                    var $rowsToRemove = $form.find('tr.removeMe');\n                    var $databasesCount = $('#filter-rows-count');\n                    var newCount = parseInt($databasesCount.text(), 10) - $rowsToRemove.length;\n                    $databasesCount.text(newCount);\n\n                    $rowsToRemove.remove();\n                    $form.find('tbody').sortTable('.name');\n                    if ($form.find('tbody').find('tr').length === 0) {\n                        // user just dropped the last db on this page\n                        refreshMainContent();\n                    }\n                    Navigation.reload();\n                } else {\n                    $form.find('tr.removeMe').removeClass('removeMe');\n                    ajaxShowMessage(data.error, false);\n                }\n            });\n\n            modal.modal('hide');\n            $('#dropDatabaseModalDropButton').off('click');\n        });\n    }\n};\n\n/**\n * @see https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener\n */\nconst CreateDatabase = {\n    /**\n     * @param {Event} event\n     */\n    handleEvent: function (event) {\n        event.preventDefault();\n\n        var $form = $(this);\n\n        // TODO Remove this section when all browsers support HTML5 \"required\" property\n        var newDbNameInput = $form.find('input[name=new_db]');\n        if (newDbNameInput.val() === '') {\n            newDbNameInput.trigger('focus');\n            alert(window.Messages.strFormEmpty);\n            return;\n        }\n        // end remove\n\n        ajaxShowMessage(window.Messages.strProcessingRequest);\n        Functions.prepareForAjaxRequest($form);\n\n        $.post($form.attr('action'), $form.serialize(), function (data) {\n            if (typeof data !== 'undefined' && data.success === true) {\n                ajaxShowMessage(data.message);\n\n                var $databasesCountObject = $('#filter-rows-count');\n                var databasesCount = parseInt($databasesCountObject.text(), 10) + 1;\n                $databasesCountObject.text(databasesCount);\n                Navigation.reload();\n\n                // make ajax request to load db structure page - taken from ajax.js\n                var dbStructUrl = data.url;\n                dbStructUrl = dbStructUrl.replace(/amp;/ig, '');\n                var params = 'ajax_request=true' + CommonParams.get('arg_separator') + 'ajax_page_request=true';\n                $.get(dbStructUrl, params, AJAX.responseHandler);\n            } else {\n                ajaxShowMessage(data.error, false);\n            }\n        });\n    }\n};\n\nfunction checkPrivilegesForDatabase () {\n    var tableRows = $('.server_databases');\n    $.each(tableRows, function () {\n        $(this).on('click', function () {\n            const db = $(this).attr('data');\n            if (db !== CommonParams.get('db')) {\n                Navigation.update(CommonParams.setAll({ 'db': db, 'table': '' }));\n            }\n        });\n    });\n}\n\nAJAX.registerTeardown('server/databases.js', function () {\n    $(document).off('submit', '#dbStatsForm');\n    $(document).off('submit', '#create_database_form.ajax');\n});\n\nAJAX.registerOnload('server/databases.js', function () {\n    $(document).on('submit', '#dbStatsForm', DropDatabases.handleEvent);\n    $(document).on('submit', '#create_database_form.ajax', CreateDatabase.handleEvent);\n    checkPrivilegesForDatabase();\n});\n"],"names":["$","AJAX","Functions","Navigation","CommonParams","ajaxShowMessage","getJsConfirmCommonParam","escapeHtml","refreshMainContent","DropDatabases","handleEvent","event","preventDefault","$form","selectedDbs","find","each","closest","addClass","length","val","text","window","Messages","strNoDatabasesSelected","question","strDropDatabaseStrongWarning","sprintf","strDoYouReally","join","modal","html","url","serialize","on","strProcessingRequest","parts","split","params","post","data","success","message","$rowsToRemove","$databasesCount","newCount","parseInt","remove","sortTable","reload","removeClass","error","off","CreateDatabase","newDbNameInput","trigger","alert","strFormEmpty","prepareForAjaxRequest","attr","$databasesCountObject","databasesCount","dbStructUrl","replace","get","responseHandler","checkPrivilegesForDatabase","tableRows","db","update","setAll","registerTeardown","document","registerOnload"],"sourceRoot":""}