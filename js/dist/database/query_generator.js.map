{"version":3,"file":"database/query_generator.js","mappings":"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","sources":["webpack://phpmyadmin/external var \"jQuery\"","webpack://phpmyadmin/./js/src/database/query_generator.js"],"sourcesContent":["module.exports = jQuery;","import $ from 'jquery';\nimport { escapeBacktick, escapeSingleQuote } from '../modules/functions/escape.js';\n\n/**\n * @fileoverview    function used in QBE for DB\n * @name            Database Operations\n *\n * @requires    jQueryUI\n */\n\nfunction getFormatsText () {\n    return {\n        '=': ' = \\'%s\\'',\n        '>': ' > \\'%s\\'',\n        '>=': ' >= \\'%s\\'',\n        '<': ' < \\'%s\\'',\n        '<=': ' <= \\'%s\\'',\n        '!=': ' != \\'%s\\'',\n        'LIKE': ' LIKE \\'%s\\'',\n        'LIKE %...%': ' LIKE \\'%%%s%%\\'',\n        'NOT LIKE': ' NOT LIKE \\'%s\\'',\n        'NOT LIKE %...%': ' NOT LIKE \\'%%%s%%\\'',\n        'BETWEEN': ' BETWEEN \\'%s\\'',\n        'NOT BETWEEN': ' NOT BETWEEN \\'%s\\'',\n        'IS NULL': ' \\'%s\\' IS NULL',\n        'IS NOT NULL': ' \\'%s\\' IS NOT NULL',\n        'REGEXP': ' REGEXP \\'%s\\'',\n        'REGEXP ^...$': ' REGEXP \\'^%s$\\'',\n        'NOT REGEXP': ' NOT REGEXP \\'%s\\''\n    };\n}\n\nfunction generateCondition (criteriaDiv, table) {\n    var query = '`' + escapeBacktick(table.val()) + '`.';\n    query += '`' + escapeBacktick(table.siblings('.columnNameSelect').first().val()) + '`';\n    if (criteriaDiv.find('.criteria_rhs').first().val() === 'text') {\n        var formatsText = getFormatsText();\n        query += window.sprintf(formatsText[criteriaDiv.find('.criteria_op').first().val()], escapeSingleQuote(criteriaDiv.find('.rhs_text_val').first().val()));\n    } else {\n        query += ' ' + criteriaDiv.find('.criteria_op').first().val();\n        query += ' `' + escapeBacktick(criteriaDiv.find('.tableNameSelect').first().val()) + '`.';\n        query += '`' + escapeBacktick(criteriaDiv.find('.columnNameSelect').first().val()) + '`';\n    }\n    return query;\n}\n\nwindow.generateWhereBlock = function () {\n    var count = 0;\n    var query = '';\n    $('.tableNameSelect').each(function () {\n        var criteriaDiv = $(this).siblings('.jsCriteriaOptions').first();\n        var useCriteria = $(this).siblings('.criteria_col').first();\n        if ($(this).val() !== '' && useCriteria.prop('checked')) {\n            if (count > 0) {\n                criteriaDiv.find('input.logical_op').each(function () {\n                    if ($(this).prop('checked')) {\n                        query += ' ' + $(this).val() + ' ';\n                    }\n                });\n            }\n            query += generateCondition(criteriaDiv, $(this));\n            count++;\n        }\n    });\n    return query;\n};\n\nfunction generateJoin (newTable, tableAliases, fk) {\n    var query = '';\n    query += ' \\n\\tLEFT JOIN ' + '`' + escapeBacktick(newTable) + '`';\n    if (tableAliases[fk.TABLE_NAME][0] !== '') {\n        query += ' AS `' + escapeBacktick(tableAliases[newTable][0]) + '`';\n        query += ' ON `' + escapeBacktick(tableAliases[fk.TABLE_NAME][0]) + '`';\n    } else {\n        query += ' ON `' + escapeBacktick(fk.TABLE_NAME) + '`';\n    }\n    query += '.`' + fk.COLUMN_NAME + '`';\n    if (tableAliases[fk.REFERENCED_TABLE_NAME][0] !== '') {\n        query += ' = `' + escapeBacktick(tableAliases[fk.REFERENCED_TABLE_NAME][0]) + '`';\n    } else {\n        query += ' = `' + escapeBacktick(fk.REFERENCED_TABLE_NAME) + '`';\n    }\n    query += '.`' + fk.REFERENCED_COLUMN_NAME + '`';\n    return query;\n}\n\nfunction existReference (table, fk, usedTables) {\n    var isReferredBy = fk.TABLE_NAME === table && usedTables.includes(fk.REFERENCED_TABLE_NAME);\n    var isReferencedBy = fk.REFERENCED_TABLE_NAME === table && usedTables.includes(fk.TABLE_NAME);\n    return isReferredBy || isReferencedBy;\n}\n\nfunction tryJoinTable (table, tableAliases, usedTables, foreignKeys) {\n    for (var i = 0; i < foreignKeys.length; i++) {\n        var fk = foreignKeys[i];\n        if (existReference(table, fk, usedTables)) {\n            return generateJoin(table, tableAliases, fk);\n        }\n    }\n    return '';\n}\n\nfunction appendTable (table, tableAliases, usedTables, foreignKeys) {\n    var query = tryJoinTable(table, tableAliases, usedTables, foreignKeys);\n    if (query === '') {\n        if (usedTables.length > 0) {\n            query += '\\n\\t, ';\n        }\n        query += '`' + escapeBacktick(table) + '`';\n        if (tableAliases[table][0] !== '') {\n            query += ' AS `' + escapeBacktick(tableAliases[table][0]) + '`';\n        }\n    }\n    usedTables.push(table);\n    return query;\n}\n\nwindow.generateFromBlock = (tableAliases, foreignKeys) => {\n    var usedTables = [];\n    var query = '';\n    for (var table in tableAliases) {\n        if (tableAliases.hasOwnProperty(table)) {\n            query += appendTable(table, tableAliases, usedTables, foreignKeys);\n        }\n    }\n    return query;\n};\n"],"names":["$","escapeBacktick","escapeSingleQuote","getFormatsText","generateCondition","criteriaDiv","table","query","val","siblings","first","find","formatsText","window","sprintf","generateWhereBlock","count","each","useCriteria","prop","generateJoin","newTable","tableAliases","fk","TABLE_NAME","COLUMN_NAME","REFERENCED_TABLE_NAME","REFERENCED_COLUMN_NAME","existReference","usedTables","isReferredBy","includes","isReferencedBy","tryJoinTable","foreignKeys","i","length","appendTable","push","generateFromBlock","hasOwnProperty"],"sourceRoot":""}