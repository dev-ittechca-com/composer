{"version":3,"file":"database/query_generator.js","mappings":"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","sources":["webpack://phpmyadmin/./js/src/database/query_generator.js"],"sourcesContent":["/**\n * @fileoverview    function used in QBE for DB\n * @name            Database Operations\n *\n * @requires    jQuery\n * @requires    jQueryUI\n * @requires    js/functions.js\n *\n */\n\n/* global sprintf */ // js/vendor/sprintf.js\n\nfunction getFormatsText () {\n    return {\n        '=': ' = \\'%s\\'',\n        '>': ' > \\'%s\\'',\n        '>=': ' >= \\'%s\\'',\n        '<': ' < \\'%s\\'',\n        '<=': ' <= \\'%s\\'',\n        '!=': ' != \\'%s\\'',\n        'LIKE': ' LIKE \\'%s\\'',\n        'LIKE %...%': ' LIKE \\'%%%s%%\\'',\n        'NOT LIKE': ' NOT LIKE \\'%s\\'',\n        'NOT LIKE %...%': ' NOT LIKE \\'%%%s%%\\'',\n        'BETWEEN': ' BETWEEN \\'%s\\'',\n        'NOT BETWEEN': ' NOT BETWEEN \\'%s\\'',\n        'IS NULL': ' \\'%s\\' IS NULL',\n        'IS NOT NULL': ' \\'%s\\' IS NOT NULL',\n        'REGEXP': ' REGEXP \\'%s\\'',\n        'REGEXP ^...$': ' REGEXP \\'^%s$\\'',\n        'NOT REGEXP': ' NOT REGEXP \\'%s\\''\n    };\n}\n\nfunction generateCondition (criteriaDiv, table) {\n    var query = '`' + Functions.escapeBacktick(table.val()) + '`.';\n    query += '`' + Functions.escapeBacktick(table.siblings('.columnNameSelect').first().val()) + '`';\n    if (criteriaDiv.find('.criteria_rhs').first().val() === 'text') {\n        var formatsText = getFormatsText();\n        query += sprintf(formatsText[criteriaDiv.find('.criteria_op').first().val()], Functions.escapeSingleQuote(criteriaDiv.find('.rhs_text_val').first().val()));\n    } else {\n        query += ' ' + criteriaDiv.find('.criteria_op').first().val();\n        query += ' `' + Functions.escapeBacktick(criteriaDiv.find('.tableNameSelect').first().val()) + '`.';\n        query += '`' + Functions.escapeBacktick(criteriaDiv.find('.columnNameSelect').first().val()) + '`';\n    }\n    return query;\n}\n\n// eslint-disable-next-line no-unused-vars\nfunction generateWhereBlock () {\n    var count = 0;\n    var query = '';\n    $('.tableNameSelect').each(function () {\n        var criteriaDiv = $(this).siblings('.jsCriteriaOptions').first();\n        var useCriteria = $(this).siblings('.criteria_col').first();\n        if ($(this).val() !== '' && useCriteria.prop('checked')) {\n            if (count > 0) {\n                criteriaDiv.find('input.logical_op').each(function () {\n                    if ($(this).prop('checked')) {\n                        query += ' ' + $(this).val() + ' ';\n                    }\n                });\n            }\n            query += generateCondition(criteriaDiv, $(this));\n            count++;\n        }\n    });\n    return query;\n}\n\nfunction generateJoin (newTable, tableAliases, fk) {\n    var query = '';\n    query += ' \\n\\tLEFT JOIN ' + '`' + Functions.escapeBacktick(newTable) + '`';\n    if (tableAliases[fk.TABLE_NAME][0] !== '') {\n        query += ' AS `' + Functions.escapeBacktick(tableAliases[newTable][0]) + '`';\n        query += ' ON `' + Functions.escapeBacktick(tableAliases[fk.TABLE_NAME][0]) + '`';\n    } else {\n        query += ' ON `' + Functions.escapeBacktick(fk.TABLE_NAME) + '`';\n    }\n    query += '.`' + fk.COLUMN_NAME + '`';\n    if (tableAliases[fk.REFERENCED_TABLE_NAME][0] !== '') {\n        query += ' = `' + Functions.escapeBacktick(tableAliases[fk.REFERENCED_TABLE_NAME][0]) + '`';\n    } else {\n        query += ' = `' + Functions.escapeBacktick(fk.REFERENCED_TABLE_NAME) + '`';\n    }\n    query += '.`' + fk.REFERENCED_COLUMN_NAME + '`';\n    return query;\n}\n\nfunction existReference (table, fk, usedTables) {\n    var isReferredBy = fk.TABLE_NAME === table && usedTables.includes(fk.REFERENCED_TABLE_NAME);\n    var isReferencedBy = fk.REFERENCED_TABLE_NAME === table && usedTables.includes(fk.TABLE_NAME);\n    return isReferredBy || isReferencedBy;\n}\n\nfunction tryJoinTable (table, tableAliases, usedTables, foreignKeys) {\n    for (var i = 0; i < foreignKeys.length; i++) {\n        var fk = foreignKeys[i];\n        if (existReference(table, fk, usedTables)) {\n            return generateJoin(table, tableAliases, fk);\n        }\n    }\n    return '';\n}\n\nfunction appendTable (table, tableAliases, usedTables, foreignKeys) {\n    var query = tryJoinTable (table, tableAliases, usedTables, foreignKeys);\n    if (query === '') {\n        if (usedTables.length > 0) {\n            query += '\\n\\t, ';\n        }\n        query += '`' + Functions.escapeBacktick(table) + '`';\n        if (tableAliases[table][0] !== '') {\n            query += ' AS `' + Functions.escapeBacktick(tableAliases[table][0]) + '`';\n        }\n    }\n    usedTables.push(table);\n    return query;\n}\n\n// eslint-disable-next-line no-unused-vars\nfunction generateFromBlock (tableAliases, foreignKeys) {\n    var usedTables = [];\n    var query = '';\n    for (var table in tableAliases) {\n        if (tableAliases.hasOwnProperty(table)) {\n            query += appendTable(table, tableAliases, usedTables, foreignKeys);\n        }\n    }\n    return query;\n}\n"],"names":["getFormatsText","generateCondition","criteriaDiv","table","query","Functions","escapeBacktick","val","siblings","first","find","formatsText","sprintf","escapeSingleQuote","generateWhereBlock","count","$","each","useCriteria","prop","generateJoin","newTable","tableAliases","fk","TABLE_NAME","COLUMN_NAME","REFERENCED_TABLE_NAME","REFERENCED_COLUMN_NAME","existReference","usedTables","isReferredBy","includes","isReferencedBy","tryJoinTable","foreignKeys","i","length","appendTable","push","generateFromBlock","hasOwnProperty"],"sourceRoot":""}