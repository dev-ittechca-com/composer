{"version":3,"file":"database/query_generator.js","mappings":"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","sources":["webpack://phpmyadmin/external var \"jQuery\"","webpack://phpmyadmin/./js/src/database/query_generator.js"],"sourcesContent":["module.exports = jQuery;","import $ from 'jquery';\nimport { escapeBacktick, escapeSingleQuote } from '../modules/functions/escape.js';\n\n/**\n * @fileoverview    function used in QBE for DB\n * @name            Database Operations\n *\n * @requires    jQueryUI\n */\n\nfunction getFormatsText () {\n    return {\n        '=': ' = \\'%s\\'',\n        '>': ' > \\'%s\\'',\n        '>=': ' >= \\'%s\\'',\n        '<': ' < \\'%s\\'',\n        '<=': ' <= \\'%s\\'',\n        '!=': ' != \\'%s\\'',\n        'LIKE': ' LIKE \\'%s\\'',\n        'LIKE %...%': ' LIKE \\'%%%s%%\\'',\n        'NOT LIKE': ' NOT LIKE \\'%s\\'',\n        'NOT LIKE %...%': ' NOT LIKE \\'%%%s%%\\'',\n        'BETWEEN': ' BETWEEN \\'%s\\'',\n        'NOT BETWEEN': ' NOT BETWEEN \\'%s\\'',\n        'IS NULL': ' \\'%s\\' IS NULL',\n        'IS NOT NULL': ' \\'%s\\' IS NOT NULL',\n        'REGEXP': ' REGEXP \\'%s\\'',\n        'REGEXP ^...$': ' REGEXP \\'^%s$\\'',\n        'NOT REGEXP': ' NOT REGEXP \\'%s\\''\n    };\n}\n\nfunction generateCondition (criteriaDiv, table) {\n    var query = '`' + escapeBacktick(table.val()) + '`.';\n    query += '`' + escapeBacktick(table.siblings('.columnNameSelect').first().val()) + '`';\n    if (criteriaDiv.find('.criteria_rhs').first().val() === 'text') {\n        var formatsText = getFormatsText();\n        query += window.sprintf(formatsText[criteriaDiv.find('.criteria_op').first().val()], escapeSingleQuote(criteriaDiv.find('.rhs_text_val').first().val()));\n    } else {\n        query += ' ' + criteriaDiv.find('.criteria_op').first().val();\n        query += ' `' + escapeBacktick(criteriaDiv.find('.tableNameSelect').first().val()) + '`.';\n        query += '`' + escapeBacktick(criteriaDiv.find('.columnNameSelect').first().val()) + '`';\n    }\n    return query;\n}\n\nwindow.generateWhereBlock = function () {\n    var count = 0;\n    var query = '';\n    $('.tableNameSelect').each(function () {\n        var criteriaDiv = $(this).siblings('.jsCriteriaOptions').first();\n        var useCriteria = $(this).siblings('.criteria_col').first();\n        if ($(this).val() !== '' && useCriteria.prop('checked')) {\n            if (count > 0) {\n                criteriaDiv.find('input.logical_op').each(function () {\n                    if ($(this).prop('checked')) {\n                        query += ' ' + $(this).val() + ' ';\n                    }\n                });\n            }\n            query += generateCondition(criteriaDiv, $(this));\n            count++;\n        }\n    });\n    return query;\n};\n\nfunction generateJoin (newTable, tableAliases, fk) {\n    var query = '';\n    query += ' \\n\\tLEFT JOIN ' + '`' + escapeBacktick(newTable) + '`';\n    if (tableAliases[fk.TABLE_NAME][0] !== '') {\n        query += ' AS `' + escapeBacktick(tableAliases[newTable][0]) + '`';\n        query += ' ON `' + escapeBacktick(tableAliases[fk.TABLE_NAME][0]) + '`';\n    } else {\n        query += ' ON `' + escapeBacktick(fk.TABLE_NAME) + '`';\n    }\n    query += '.`' + fk.COLUMN_NAME + '`';\n    if (tableAliases[fk.REFERENCED_TABLE_NAME][0] !== '') {\n        query += ' = `' + escapeBacktick(tableAliases[fk.REFERENCED_TABLE_NAME][0]) + '`';\n    } else {\n        query += ' = `' + escapeBacktick(fk.REFERENCED_TABLE_NAME) + '`';\n    }\n    query += '.`' + fk.REFERENCED_COLUMN_NAME + '`';\n    return query;\n}\n\nfunction existReference (table, fk, usedTables) {\n    var isReferredBy = fk.TABLE_NAME === table && usedTables.includes(fk.REFERENCED_TABLE_NAME);\n    var isReferencedBy = fk.REFERENCED_TABLE_NAME === table && usedTables.includes(fk.TABLE_NAME);\n    return isReferredBy || isReferencedBy;\n}\n\nfunction tryJoinTable (table, tableAliases, usedTables, foreignKeys) {\n    for (var i = 0; i < foreignKeys.length; i++) {\n        var fk = foreignKeys[i];\n        if (existReference(table, fk, usedTables)) {\n            return generateJoin(table, tableAliases, fk);\n        }\n    }\n    return '';\n}\n\nfunction appendTable (table, tableAliases, usedTables, foreignKeys) {\n    var query = tryJoinTable(table, tableAliases, usedTables, foreignKeys);\n    if (query === '') {\n        if (usedTables.length > 0) {\n            query += '\\n\\t, ';\n        }\n        query += '`' + escapeBacktick(table) + '`';\n        if (tableAliases[table][0] !== '') {\n            query += ' AS `' + escapeBacktick(tableAliases[table][0]) + '`';\n        }\n    }\n    usedTables.push(table);\n    return query;\n}\n\nwindow.generateFromBlock = (tableAliases, foreignKeys) => {\n    var usedTables = [];\n    var query = '';\n    for (var table in tableAliases) {\n        if (tableAliases.hasOwnProperty(table)) {\n            query += appendTable(table, tableAliases, usedTables, foreignKeys);\n        }\n    }\n    return query;\n};\n"],"names":["$","escapeBacktick","escapeSingleQuote","getFormatsText","generateCondition","criteriaDiv","table","query","val","siblings","first","find","formatsText","window","sprintf","generateWhereBlock","count","each","useCriteria","prop","generateJoin","newTable","tableAliases","fk","TABLE_NAME","COLUMN_NAME","REFERENCED_TABLE_NAME","REFERENCED_COLUMN_NAME","existReference","usedTables","isReferredBy","includes","isReferencedBy","tryJoinTable","foreignKeys","i","length","appendTable","push","generateFromBlock","hasOwnProperty"],"sourceRoot":""}