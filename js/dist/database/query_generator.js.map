{"version":3,"file":"database/query_generator.js","mappings":"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","sources":["webpack://phpmyadmin/./js/src/database/query_generator.js"],"sourcesContent":["/**\n * @fileoverview    function used in QBE for DB\n * @name            Database Operations\n *\n * @requires    jQuery\n * @requires    jQueryUI\n * @requires    js/functions.js\n *\n */\n\nfunction getFormatsText () {\n    return {\n        '=': ' = \\'%s\\'',\n        '>': ' > \\'%s\\'',\n        '>=': ' >= \\'%s\\'',\n        '<': ' < \\'%s\\'',\n        '<=': ' <= \\'%s\\'',\n        '!=': ' != \\'%s\\'',\n        'LIKE': ' LIKE \\'%s\\'',\n        'LIKE %...%': ' LIKE \\'%%%s%%\\'',\n        'NOT LIKE': ' NOT LIKE \\'%s\\'',\n        'NOT LIKE %...%': ' NOT LIKE \\'%%%s%%\\'',\n        'BETWEEN': ' BETWEEN \\'%s\\'',\n        'NOT BETWEEN': ' NOT BETWEEN \\'%s\\'',\n        'IS NULL': ' \\'%s\\' IS NULL',\n        'IS NOT NULL': ' \\'%s\\' IS NOT NULL',\n        'REGEXP': ' REGEXP \\'%s\\'',\n        'REGEXP ^...$': ' REGEXP \\'^%s$\\'',\n        'NOT REGEXP': ' NOT REGEXP \\'%s\\''\n    };\n}\n\nfunction generateCondition (criteriaDiv, table) {\n    var query = '`' + Functions.escapeBacktick(table.val()) + '`.';\n    query += '`' + Functions.escapeBacktick(table.siblings('.columnNameSelect').first().val()) + '`';\n    if (criteriaDiv.find('.criteria_rhs').first().val() === 'text') {\n        var formatsText = getFormatsText();\n        query += window.sprintf(formatsText[criteriaDiv.find('.criteria_op').first().val()], Functions.escapeSingleQuote(criteriaDiv.find('.rhs_text_val').first().val()));\n    } else {\n        query += ' ' + criteriaDiv.find('.criteria_op').first().val();\n        query += ' `' + Functions.escapeBacktick(criteriaDiv.find('.tableNameSelect').first().val()) + '`.';\n        query += '`' + Functions.escapeBacktick(criteriaDiv.find('.columnNameSelect').first().val()) + '`';\n    }\n    return query;\n}\n\nwindow.generateWhereBlock = function () {\n    var count = 0;\n    var query = '';\n    $('.tableNameSelect').each(function () {\n        var criteriaDiv = $(this).siblings('.jsCriteriaOptions').first();\n        var useCriteria = $(this).siblings('.criteria_col').first();\n        if ($(this).val() !== '' && useCriteria.prop('checked')) {\n            if (count > 0) {\n                criteriaDiv.find('input.logical_op').each(function () {\n                    if ($(this).prop('checked')) {\n                        query += ' ' + $(this).val() + ' ';\n                    }\n                });\n            }\n            query += generateCondition(criteriaDiv, $(this));\n            count++;\n        }\n    });\n    return query;\n};\n\nfunction generateJoin (newTable, tableAliases, fk) {\n    var query = '';\n    query += ' \\n\\tLEFT JOIN ' + '`' + Functions.escapeBacktick(newTable) + '`';\n    if (tableAliases[fk.TABLE_NAME][0] !== '') {\n        query += ' AS `' + Functions.escapeBacktick(tableAliases[newTable][0]) + '`';\n        query += ' ON `' + Functions.escapeBacktick(tableAliases[fk.TABLE_NAME][0]) + '`';\n    } else {\n        query += ' ON `' + Functions.escapeBacktick(fk.TABLE_NAME) + '`';\n    }\n    query += '.`' + fk.COLUMN_NAME + '`';\n    if (tableAliases[fk.REFERENCED_TABLE_NAME][0] !== '') {\n        query += ' = `' + Functions.escapeBacktick(tableAliases[fk.REFERENCED_TABLE_NAME][0]) + '`';\n    } else {\n        query += ' = `' + Functions.escapeBacktick(fk.REFERENCED_TABLE_NAME) + '`';\n    }\n    query += '.`' + fk.REFERENCED_COLUMN_NAME + '`';\n    return query;\n}\n\nfunction existReference (table, fk, usedTables) {\n    var isReferredBy = fk.TABLE_NAME === table && usedTables.includes(fk.REFERENCED_TABLE_NAME);\n    var isReferencedBy = fk.REFERENCED_TABLE_NAME === table && usedTables.includes(fk.TABLE_NAME);\n    return isReferredBy || isReferencedBy;\n}\n\nfunction tryJoinTable (table, tableAliases, usedTables, foreignKeys) {\n    for (var i = 0; i < foreignKeys.length; i++) {\n        var fk = foreignKeys[i];\n        if (existReference(table, fk, usedTables)) {\n            return generateJoin(table, tableAliases, fk);\n        }\n    }\n    return '';\n}\n\nfunction appendTable (table, tableAliases, usedTables, foreignKeys) {\n    var query = tryJoinTable (table, tableAliases, usedTables, foreignKeys);\n    if (query === '') {\n        if (usedTables.length > 0) {\n            query += '\\n\\t, ';\n        }\n        query += '`' + Functions.escapeBacktick(table) + '`';\n        if (tableAliases[table][0] !== '') {\n            query += ' AS `' + Functions.escapeBacktick(tableAliases[table][0]) + '`';\n        }\n    }\n    usedTables.push(table);\n    return query;\n}\n\nwindow.generateFromBlock = (tableAliases, foreignKeys) => {\n    var usedTables = [];\n    var query = '';\n    for (var table in tableAliases) {\n        if (tableAliases.hasOwnProperty(table)) {\n            query += appendTable(table, tableAliases, usedTables, foreignKeys);\n        }\n    }\n    return query;\n};\n"],"names":["getFormatsText","generateCondition","criteriaDiv","table","query","Functions","escapeBacktick","val","siblings","first","find","formatsText","window","sprintf","escapeSingleQuote","generateWhereBlock","count","$","each","useCriteria","prop","generateJoin","newTable","tableAliases","fk","TABLE_NAME","COLUMN_NAME","REFERENCED_TABLE_NAME","REFERENCED_COLUMN_NAME","existReference","usedTables","isReferredBy","includes","isReferencedBy","tryJoinTable","foreignKeys","i","length","appendTable","push","generateFromBlock","hasOwnProperty"],"sourceRoot":""}