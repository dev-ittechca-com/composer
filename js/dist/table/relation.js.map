{"version":3,"file":"table/relation.js","mappings":"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","sources":["webpack://phpmyadmin/external var \"jQuery\"","webpack://phpmyadmin/./js/src/table/relation.js"],"sourcesContent":["module.exports = jQuery;","import $ from 'jquery';\nimport { AJAX } from '../modules/ajax.js';\nimport { Functions } from '../modules/functions.js';\nimport { CommonActions, CommonParams } from '../modules/common.js';\n\n/**\n * for table relation\n */\n\nvar TableRelation = {};\n\nTableRelation.showHideClauses = function ($thisDropdown) {\n    if ($thisDropdown.val() === '') {\n        $thisDropdown.parent().nextAll('span').hide();\n    } else {\n        if ($thisDropdown.is('select[name^=\"destination_foreign_column\"]')) {\n            $thisDropdown.parent().nextAll('span').show();\n        }\n    }\n};\n\n/**\n * Sets dropdown options to values\n * @param $dropdown\n * @param values\n * @param selectedValue\n * @return {void}\n */\nTableRelation.setDropdownValues = function ($dropdown, values, selectedValue) {\n    $dropdown.empty();\n    var optionsAsString = '';\n    // add an empty string to the beginning for empty selection\n    values.unshift('');\n    $.each(values, function () {\n        optionsAsString += '<option value=\\'' + Functions.escapeHtml(this) + '\\'' + (selectedValue === Functions.escapeHtml(this) ? ' selected=\\'selected\\'' : '') + '>' + Functions.escapeHtml(this) + '</option>';\n    });\n    $dropdown.append($(optionsAsString));\n};\n\n/**\n * Retrieves and populates dropdowns to the left based on the selected value\n *\n * @param $dropdown the dropdown whose value got changed\n * @return {void}\n */\nTableRelation.getDropdownValues = function ($dropdown) {\n    var foreignDb = null;\n    var foreignTable = null;\n    var $databaseDd;\n    var $tableDd;\n    var $columnDd;\n    var foreign = '';\n    // if the changed dropdown is for foreign key constraints\n    if ($dropdown.is('select[name^=\"destination_foreign\"]')) {\n        $databaseDd = $dropdown.parent().parent().parent().find('select[name^=\"destination_foreign_db\"]');\n        $tableDd    = $dropdown.parent().parent().parent().find('select[name^=\"destination_foreign_table\"]');\n        $columnDd   = $dropdown.parent().parent().parent().find('select[name^=\"destination_foreign_column\"]');\n        foreign = '_foreign';\n    } else { // internal relations\n        $databaseDd = $dropdown.parent().find('select[name^=\"destination_db\"]');\n        $tableDd    = $dropdown.parent().find('select[name^=\"destination_table\"]');\n        $columnDd   = $dropdown.parent().find('select[name^=\"destination_column\"]');\n    }\n\n    // if the changed dropdown is a database selector\n    if ($dropdown.is('select[name^=\"destination' + foreign + '_db\"]')) {\n        foreignDb = $dropdown.val();\n        // if no database is selected empty table and column dropdowns\n        if (foreignDb === '') {\n            TableRelation.setDropdownValues($tableDd, []);\n            TableRelation.setDropdownValues($columnDd, []);\n            return;\n        }\n    } else { // if a table selector\n        foreignDb = $databaseDd.val();\n        foreignTable = $dropdown.val();\n        // if no table is selected empty the column dropdown\n        if (foreignTable === '') {\n            TableRelation.setDropdownValues($columnDd, []);\n            return;\n        }\n    }\n    var $msgbox = Functions.ajaxShowMessage();\n    var $form = $dropdown.parents('form');\n    var $db = $form.find('input[name=\"db\"]').val();\n    var $table = $form.find('input[name=\"table\"]').val();\n    var argsep = CommonParams.get('arg_separator');\n    var params = 'getDropdownValues=true' + argsep + 'ajax_request=true' +\n        argsep + 'db=' + encodeURIComponent($db) +\n        argsep + 'table=' + encodeURIComponent($table) +\n        argsep + 'foreign=' + (foreign !== '') +\n        argsep + 'foreignDb=' + encodeURIComponent(foreignDb) +\n        (foreignTable !== null ?\n            argsep + 'foreignTable=' + encodeURIComponent(foreignTable) : ''\n        );\n    var $server = $form.find('input[name=\"server\"]');\n    if ($server.length > 0) {\n        params += argsep + 'server=' + $form.find('input[name=\"server\"]').val();\n    }\n    $.ajax({\n        type: 'POST',\n        url: 'index.php?route=/table/relation',\n        data: params,\n        dataType: 'json',\n        success: function (data) {\n            Functions.ajaxRemoveMessage($msgbox);\n            if (typeof data !== 'undefined' && data.success) {\n                // if the changed dropdown is a database selector\n                if (foreignTable === null) {\n                    // set values for table and column dropdowns\n                    TableRelation.setDropdownValues($tableDd, data.tables);\n                    TableRelation.setDropdownValues($columnDd, []);\n                } else { // if a table selector\n                    // set values for the column dropdown\n                    var primary = null;\n                    if (typeof data.primary !== 'undefined'\n                        && 1 === data.primary.length\n                    ) {\n                        primary = data.primary[0];\n                    }\n                    TableRelation.setDropdownValues($columnDd.first(), data.columns, primary);\n                    TableRelation.setDropdownValues($columnDd.slice(1), data.columns);\n                }\n            } else {\n                Functions.ajaxShowMessage(data.error, false);\n            }\n        }\n    });\n};\n\n/**\n * Unbind all event handlers before tearing down a page\n */\nAJAX.registerTeardown('table/relation.js', function () {\n    $('body').off('change',\n        'select[name^=\"destination_db\"], ' +\n        'select[name^=\"destination_table\"], ' +\n        'select[name^=\"destination_foreign_db\"], ' +\n        'select[name^=\"destination_foreign_table\"]'\n    );\n    $('body').off('click', 'a.add_foreign_key_field');\n    $('body').off('click', 'a.add_foreign_key');\n    $('a.drop_foreign_key_anchor.ajax').off('click');\n});\n\nAJAX.registerOnload('table/relation.js', function () {\n    /**\n     * Ajax event handler to fetch table/column dropdown values.\n     */\n    $('body').on('change',\n        'select[name^=\"destination_db\"], ' +\n        'select[name^=\"destination_table\"], ' +\n        'select[name^=\"destination_foreign_db\"], ' +\n        'select[name^=\"destination_foreign_table\"]',\n        function () {\n            TableRelation.getDropdownValues($(this));\n        }\n    );\n\n    /**\n     * Ajax event handler to add a column to a foreign key constraint.\n     */\n    $('body').on('click', 'a.add_foreign_key_field', function (event) {\n        event.preventDefault();\n        event.stopPropagation();\n\n        // Add field.\n        $(this)\n            .prev('span')\n            .clone(true, true)\n            .insertBefore($(this))\n            .find('select')\n            .val('');\n\n        // Add foreign field.\n        var $sourceElem = $('select[name^=\"destination_foreign_column[' +\n            $(this).attr('data-index') + ']\"]').last().parent();\n        $sourceElem\n            .clone(true, true)\n            .insertAfter($sourceElem)\n            .find('select')\n            .val('');\n    });\n\n    /**\n     * Ajax event handler to add a foreign key constraint.\n     */\n    $('body').on('click', 'a.add_foreign_key', function (event) {\n        event.preventDefault();\n        event.stopPropagation();\n\n        var $prevRow = $(this).closest('tr').prev('tr');\n        var $newRow = $prevRow.clone(true, true);\n\n        // Update serial number.\n        var currIndex = $newRow\n            .find('a.add_foreign_key_field')\n            .attr('data-index');\n        var newIndex = parseInt(currIndex) + 1;\n        $newRow.find('a.add_foreign_key_field').attr('data-index', newIndex);\n\n        // Update form parameter names.\n        $newRow.find('select[name^=\"foreign_key_fields_name\"]')\n            .not($newRow.find('select[name^=\"foreign_key_fields_name\"]').first())\n            .find('select[name^=\"destination_foreign_column\"]')\n            .not($newRow.find('select[name^=\"foreign_key_fields_name\"]')\n                .not($newRow.find('select[name^=\"foreign_key_fields_name\"]').first())\n                .find('select[name^=\"destination_foreign_column\"]').first()\n            ).each(function () {\n                $(this).parent().remove();\n            });\n        $newRow.find('input, select').each(function () {\n            $(this).attr('name',\n                $(this).attr('name').replace(/\\d/, newIndex)\n            );\n        });\n        $newRow.find('input[type=\"text\"]').each(function () {\n            $(this).val('');\n        });\n        // Finally add the row.\n        $newRow.insertAfter($prevRow);\n    });\n\n    /**\n     * Ajax Event handler for 'Drop Foreign key'\n     */\n    $('a.drop_foreign_key_anchor.ajax').on('click', function (event) {\n        event.preventDefault();\n        var $anchor = $(this);\n\n        // Object containing reference to the current field's row\n        var $currRow = $anchor.parents('tr');\n\n        var dropQuery = Functions.escapeHtml(\n            $currRow.children('td')\n                .children('.drop_foreign_key_msg')\n                .val()\n        );\n\n        var question = window.sprintf(window.Messages.strDoYouReally, dropQuery);\n\n        $anchor.confirm(question, $anchor.attr('href'), function (url) {\n            var $msg = Functions.ajaxShowMessage(window.Messages.strDroppingForeignKey, false);\n            var params = Functions.getJsConfirmCommonParam(this, $anchor.getPostData());\n            $.post(url, params, function (data) {\n                if (data.success === true) {\n                    Functions.ajaxRemoveMessage($msg);\n                    CommonActions.refreshMain(false, function () {\n                        // Do nothing\n                    });\n                } else {\n                    Functions.ajaxShowMessage(window.Messages.strErrorProcessingRequest + ' : ' + data.error, false);\n                }\n            }); // end $.post()\n        });\n    }); // end Drop Foreign key\n\n    var windowWidth = $(window).width();\n    $('.jsresponsive').css('max-width', (windowWidth - 35) + 'px');\n});\n"],"names":["$","AJAX","Functions","CommonActions","CommonParams","TableRelation","showHideClauses","$thisDropdown","val","parent","nextAll","hide","is","show","setDropdownValues","$dropdown","values","selectedValue","empty","optionsAsString","unshift","each","escapeHtml","append","getDropdownValues","foreignDb","foreignTable","$databaseDd","$tableDd","$columnDd","foreign","find","$msgbox","ajaxShowMessage","$form","parents","$db","$table","argsep","get","params","encodeURIComponent","$server","length","ajax","type","url","data","dataType","success","ajaxRemoveMessage","tables","primary","first","columns","slice","error","registerTeardown","off","registerOnload","on","event","preventDefault","stopPropagation","prev","clone","insertBefore","$sourceElem","attr","last","insertAfter","$prevRow","closest","$newRow","currIndex","newIndex","parseInt","not","remove","replace","$anchor","$currRow","dropQuery","children","question","window","sprintf","Messages","strDoYouReally","confirm","$msg","strDroppingForeignKey","getJsConfirmCommonParam","getPostData","post","refreshMain","strErrorProcessingRequest","windowWidth","width","css"],"sourceRoot":""}