{"version":3,"file":"designer/page.js","mappings":";AAAA;AAA+B;AAC/B;;AACA;AAAuC;;AACvC;AAA0B;;AAC1B;AAA6B;AAE7B,IAAIA,YAAY,GAAG,EAAnB;;AAEAA,YAAY,CAACC,uBAAb,GAAuC,UAAUC,EAAV,EAAc;AACjDF,EAAAA,YAAY,CAACG,aAAb,CAA2BD,EAA3B,EAA+B,UAAUE,IAAV,EAAgB;AAC3C,QAAIA,IAAJ,EAAU;AACNJ,MAAAA,YAAY,CAACK,eAAb,CAA6BD,IAAI,CAACE,IAAlC;AACAC,MAAAA,YAAY,GAAGH,IAAI,CAACE,IAApB;AACH,KAHD,MAGO;AACHN,MAAAA,YAAY,CAACQ,iBAAb,CAA+B,IAA/B;AACH;AACJ,GAPD;AAQH,CATD;;AAWAR,YAAY,CAACS,aAAb,GAA6B,UAAUP,EAAV,EAAcQ,QAAd,EAAwBC,cAAxB,EAAwCC,QAAxC,EAAkD;AAC3EZ,EAAAA,YAAY,CAACa,aAAb,CAA2BX,EAA3B,EAA+BQ,QAA/B,EAAyC,UAAUN,IAAV,EAAgB;AACrD,QAAIA,IAAJ,EAAU;AACN,UAAIU,QAAQ,GAAG,EAAf;;AACA,UAAIC,YAAY,GAAG,UAAUC,EAAV,EAAc;AAC7BF,QAAAA,QAAQ,CAACG,IAAT,CAAcD,EAAd;;AACA,YAAIL,cAAc,CAACO,MAAf,KAA0BJ,QAAQ,CAACI,MAAvC,EAA+C;AAC3Cd,UAAAA,IAAI,CAACU,QAAL,GAAgBA,QAAhB;AACAK,UAAAA,iBAAiB,CAACC,SAAlB,CAA4B,WAA5B,EAAyChB,IAAzC;AACH;AACJ,OAND;;AAOA,WAAK,IAAIiB,GAAG,GAAG,CAAf,EAAkBA,GAAG,GAAGV,cAAc,CAACO,MAAvC,EAA+CG,GAAG,EAAlD,EAAsD;AAClDV,QAAAA,cAAc,CAACU,GAAD,CAAd,CAAoBC,OAApB,GAA8BlB,IAAI,CAACE,IAAnC;AACAN,QAAAA,YAAY,CAACuB,kBAAb,CAAgCZ,cAAc,CAACU,GAAD,CAA9C,EAAqDN,YAArD;AACH;;AACD,UAAI,OAAOH,QAAP,KAAoB,WAAxB,EAAqC;AACjCA,QAAAA,QAAQ,CAACR,IAAD,CAAR;AACH;AACJ;AACJ,GAlBD;AAmBH,CApBD;;AAsBAJ,YAAY,CAACwB,kBAAb,GAAkC,UAAUtB,EAAV,EAAcuB,MAAd,EAAsBf,QAAtB,EAAgCC,cAAhC,EAAgDC,QAAhD,EAA0D;AACxFZ,EAAAA,YAAY,CAAC0B,UAAb,CAAwBD,MAAxB;AACAzB,EAAAA,YAAY,CAACS,aAAb,CAA2BP,EAA3B,EAA+BQ,QAA/B,EAAyCC,cAAzC,EAAyD,UAAUP,IAAV,EAAgB;AACrE,QAAI,OAAOQ,QAAP,KAAoB,WAAxB,EAAqC;AACjCA,MAAAA,QAAQ,CAACR,IAAD,CAAR;AACH;;AACDG,IAAAA,YAAY,GAAGH,IAAI,CAACE,IAApB;AACH,GALD;AAMH,CARD;;AAUAN,YAAY,CAACa,aAAb,GAA6B,UAAUX,EAAV,EAAcQ,QAAd,EAAwBE,QAAxB,EAAkC;AAC3D,MAAIe,OAAO,GAAG,IAAIC,eAAe,CAACC,OAApB,CAA4B3B,EAA5B,EAAgCQ,QAAhC,CAAd;AACAS,EAAAA,iBAAiB,CAACC,SAAlB,CAA4B,WAA5B,EAAyCO,OAAzC,EAAkD,UAAUrB,IAAV,EAAgB;AAC9DqB,IAAAA,OAAO,CAACrB,IAAR,GAAeA,IAAf;;AACA,QAAI,OAAOM,QAAP,KAAoB,WAAxB,EAAqC;AACjCA,MAAAA,QAAQ,CAACe,OAAD,CAAR;AACH;AACJ,GALD;AAMH,CARD;;AAUA3B,YAAY,CAACuB,kBAAb,GAAkC,UAAUO,SAAV,EAAqBlB,QAArB,EAA+B;AAC7DO,EAAAA,iBAAiB,CAACC,SAAlB,CAA4B,cAA5B,EAA4CU,SAA5C,EAAuDlB,QAAvD;AACH,CAFD;;AAIAZ,YAAY,CAAC+B,cAAb,GAA8B,UAAU7B,EAAV,EAAcU,QAAd,EAAwB;AAClDO,EAAAA,iBAAiB,CAACa,cAAlB,CAAiC,WAAjC,EAA8C,UAAUC,KAAV,EAAiB;AAC3D,QAAIC,IAAI,GAAG,EAAX;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,KAAK,CAACf,MAA1B,EAAkCiB,CAAC,EAAnC,EAAuC;AACnC,UAAI/B,IAAI,GAAG6B,KAAK,CAACE,CAAD,CAAhB;;AACA,UAAI/B,IAAI,CAACgC,MAAL,KAAgBlC,EAApB,EAAwB;AACpBgC,QAAAA,IAAI,IAAI,oBAAoB9B,IAAI,CAACE,IAAzB,GAAgC,IAAxC;AACA4B,QAAAA,IAAI,IAAIG,SAAS,CAACC,UAAV,CAAqBlC,IAAI,CAACmC,SAA1B,IAAuC,WAA/C;AACH;AACJ;;AACD,QAAI,OAAO3B,QAAP,KAAoB,WAAxB,EAAqC;AACjCA,MAAAA,QAAQ,CAACsB,IAAD,CAAR;AACH;AACJ,GAZD;AAaH,CAdD;;AAgBAlC,YAAY,CAAC0B,UAAb,GAA0B,UAAUD,MAAV,EAAkBb,QAAlB,EAA4B;AAClDO,EAAAA,iBAAiB,CAACqB,UAAlB,CAA6B,WAA7B,EAA0Cf,MAA1C,EAAkD,UAAUrB,IAAV,EAAgB;AAC9D,QAAIA,IAAJ,EAAU;AACN,WAAK,IAAIqC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGrC,IAAI,CAACU,QAAL,CAAcI,MAAlC,EAA0CuB,CAAC,EAA3C,EAA+C;AAC3CtB,QAAAA,iBAAiB,CAACuB,YAAlB,CAA+B,cAA/B,EAA+CtC,IAAI,CAACU,QAAL,CAAc2B,CAAd,CAA/C;AACH;;AACDtB,MAAAA,iBAAiB,CAACuB,YAAlB,CAA+B,WAA/B,EAA4CjB,MAA5C,EAAoDb,QAApD;AACH;AACJ,GAPD;AAQH,CATD;;AAWAZ,YAAY,CAACG,aAAb,GAA6B,UAAUD,EAAV,EAAcU,QAAd,EAAwB;AACjDO,EAAAA,iBAAiB,CAACa,cAAlB,CAAiC,WAAjC,EAA8C,UAAUC,KAAV,EAAiB;AAC3D,QAAIU,SAAS,GAAG,IAAhB;;AACA,SAAK,IAAIF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGR,KAAK,CAACf,MAA1B,EAAkCuB,CAAC,EAAnC,EAAuC;AACnC,UAAIrC,IAAI,GAAG6B,KAAK,CAACQ,CAAD,CAAhB;;AACA,UAAIrC,IAAI,CAACgC,MAAL,KAAgBlC,EAApB,EAAwB;AACpB;AACA,YAAIE,IAAI,CAACmC,SAAL,KAAmBrC,EAAvB,EAA2B;AACvBU,UAAAA,QAAQ,CAACR,IAAD,CAAR;AACA;AACH;;AACD,YAAIuC,SAAS,KAAK,IAAlB,EAAwB;AACpBA,UAAAA,SAAS,GAAGvC,IAAZ;AACH;AACJ;AACJ;;AACDQ,IAAAA,QAAQ,CAAC+B,SAAD,CAAR;AACH,GAhBD;AAiBH,CAlBD;;AAoBA3C,YAAY,CAACQ,iBAAb,GAAiC,UAAUoC,KAAV,EAAiB;AAC9C,MAAIC,SAAS,GAAGC,CAAC,CAAC,gBAAD,CAAD,CAAoBC,IAApB,CAAyB,mBAAzB,CAAhB;AACAF,EAAAA,SAAS,CAACG,IAAV,CAAe,SAAf,EAA0BJ,KAA1B;;AACA,OAAK,IAAIK,GAAG,GAAG,CAAf,EAAkBA,GAAG,GAAGJ,SAAS,CAAC3B,MAAlC,EAA0C+B,GAAG,EAA7C,EAAiD;AAC7C,QAAIC,KAAK,GAAGL,SAAS,CAACI,GAAD,CAArB;;AACA,QAAIC,KAAK,CAACC,KAAV,EAAiB;AACb,UAAIC,OAAO,GAAGC,QAAQ,CAACC,cAAT,CAAwBJ,KAAK,CAACC,KAA9B,CAAd;AACAC,MAAAA,OAAO,CAACG,KAAR,CAAcC,GAAd,GAAoBxD,YAAY,CAACyD,SAAb,CAAuB,GAAvB,EAA4B,EAA5B,IAAkC,IAAtD;AACAL,MAAAA,OAAO,CAACG,KAAR,CAAcG,IAAd,GAAqB1D,YAAY,CAACyD,SAAb,CAAuB,GAAvB,EAA4B,EAA5B,IAAkC,IAAvD;AACAE,MAAAA,YAAY,CAACC,UAAb,CAAwBV,KAAxB,EAA+BA,KAAK,CAACC,KAArC;AACH;AACJ;;AACD5C,EAAAA,YAAY,GAAG,CAAC,CAAhB;AACAuC,EAAAA,CAAC,CAAC,YAAD,CAAD,CAAgBe,IAAhB,CAAqBC,QAAQ,CAACC,WAA9B;AACAJ,EAAAA,YAAY,CAACK,WAAb;AACH,CAfD;;AAiBAhE,YAAY,CAACK,eAAb,GAA+B,UAAUoB,MAAV,EAAkB;AAC7CzB,EAAAA,YAAY,CAACQ,iBAAb,CAA+B,IAA/B;AACAR,EAAAA,YAAY,CAACiE,eAAb,CAA6BxC,MAA7B,EAAqC,UAAUrB,IAAV,EAAgBU,QAAhB,EAA0B;AAC3DgC,IAAAA,CAAC,CAAC,aAAD,CAAD,CAAiBC,IAAjB,CAAsB,YAAtB,EAAoCc,IAApC,CAAyCzD,IAAI,CAACmC,SAA9C;AACA,QAAI2B,YAAY,GAAG,KAAnB;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGrD,QAAQ,CAACI,MAA7B,EAAqCiD,CAAC,EAAtC,EAA0C;AACtC,UAAIC,IAAI,GAAGlE,EAAE,GAAG,GAAL,GAAWY,QAAQ,CAACqD,CAAD,CAAR,CAAYE,SAAlC;AACA,UAAIC,KAAK,GAAGjB,QAAQ,CAACC,cAAT,CAAwBc,IAAxB,CAAZ;;AACA,UAAIE,KAAK,KAAK,IAAd,EAAoB;AAChBJ,QAAAA,YAAY,GAAG,IAAf;AACA;AACH;;AACDI,MAAAA,KAAK,CAACf,KAAN,CAAYC,GAAZ,GAAkB1C,QAAQ,CAACqD,CAAD,CAAR,CAAYI,CAAZ,GAAgB,IAAlC;AACAD,MAAAA,KAAK,CAACf,KAAN,CAAYG,IAAZ,GAAmB5C,QAAQ,CAACqD,CAAD,CAAR,CAAYK,CAAZ,GAAgB,IAAnC;AAEA,UAAIC,QAAQ,GAAGpB,QAAQ,CAACC,cAAT,CAAwB,eAAec,IAAvC,CAAf;AACAK,MAAAA,QAAQ,CAACC,OAAT,GAAmB,IAAnB;AACAf,MAAAA,YAAY,CAACC,UAAb,CAAwBa,QAAxB,EAAkCA,QAAQ,CAACtB,KAA3C;AACH;;AACDQ,IAAAA,YAAY,CAACgB,SAAb;;AACA,QAAIT,YAAY,KAAK,IAArB,EAA2B;AACvBP,MAAAA,YAAY,CAACK,WAAb;AACA3B,MAAAA,SAAS,CAACuC,eAAV,CAA0Bd,QAAQ,CAACe,wBAAnC;AACH;;AACDtE,IAAAA,YAAY,GAAGH,IAAI,CAACE,IAApB;AACH,GAvBD;AAwBH,CA1BD;;AA4BAN,YAAY,CAACiE,eAAb,GAA+B,UAAUxC,MAAV,EAAkBb,QAAlB,EAA4B;AACvDO,EAAAA,iBAAiB,CAACqB,UAAlB,CAA6B,WAA7B,EAA0Cf,MAA1C,EAAkD,UAAUrB,IAAV,EAAgB;AAC9D,QAAIU,QAAQ,GAAG,EAAf;AACA,QAAIgE,KAAK,GAAG1E,IAAI,CAACU,QAAL,CAAcI,MAA1B;;AACA,SAAK,IAAIuB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGqC,KAApB,EAA2BrC,CAAC,EAA5B,EAAgC;AAC5BtB,MAAAA,iBAAiB,CAACqB,UAAlB,CAA6B,cAA7B,EAA6CpC,IAAI,CAACU,QAAL,CAAc2B,CAAd,CAA7C,EAA+D,UAAUsC,OAAV,EAAmB;AAC9EjE,QAAAA,QAAQ,CAACG,IAAT,CAAc8D,OAAd;;AACA,YAAIjE,QAAQ,CAACI,MAAT,KAAoB4D,KAAxB,EAA+B;AAC3B,cAAI,OAAOlE,QAAP,KAAoB,WAAxB,EAAqC;AACjCA,YAAAA,QAAQ,CAACR,IAAD,EAAOU,QAAP,CAAR;AACH;AACJ;AACJ,OAPD;AAQH;AACJ,GAbD;AAcH,CAfD;;AAiBAd,YAAY,CAACyD,SAAb,GAAyB,UAAUuB,GAAV,EAAeC,GAAf,EAAoB;AACzC,MAAIC,GAAG,GAAGC,IAAI,CAACC,MAAL,MAAiBJ,GAAG,GAAGC,GAAvB,IAA8BA,GAAxC;AACA,SAAOE,IAAI,CAACE,KAAL,CAAWH,GAAX,CAAP;AACH,CAHD,C","sources":["webpack://phpmyadmin/./js/src/designer/page.js"],"sourcesContent":["/* global DesignerOfflineDB */ // js/designer/database.js\n// eslint-disable-next-line no-unused-vars\n/* global db, selectedPage:writable */ // js/designer/init.js\n/* global DesignerMove */ // js/designer/move.js\n/* global DesignerObjects */ // js/designer/objects.js\n\nvar DesignerPage = {};\n\nDesignerPage.showTablesInLandingPage = function (db) {\n    DesignerPage.loadFirstPage(db, function (page) {\n        if (page) {\n            DesignerPage.loadHtmlForPage(page.pgNr);\n            selectedPage = page.pgNr;\n        } else {\n            DesignerPage.showNewPageTables(true);\n        }\n    });\n};\n\nDesignerPage.saveToNewPage = function (db, pageName, tablePositions, callback) {\n    DesignerPage.createNewPage(db, pageName, function (page) {\n        if (page) {\n            var tblCords = [];\n            var saveCallback = function (id) {\n                tblCords.push(id);\n                if (tablePositions.length === tblCords.length) {\n                    page.tblCords = tblCords;\n                    DesignerOfflineDB.addObject('pdf_pages', page);\n                }\n            };\n            for (var pos = 0; pos < tablePositions.length; pos++) {\n                tablePositions[pos].pdfPgNr = page.pgNr;\n                DesignerPage.saveTablePositions(tablePositions[pos], saveCallback);\n            }\n            if (typeof callback !== 'undefined') {\n                callback(page);\n            }\n        }\n    });\n};\n\nDesignerPage.saveToSelectedPage = function (db, pageId, pageName, tablePositions, callback) {\n    DesignerPage.deletePage(pageId);\n    DesignerPage.saveToNewPage(db, pageName, tablePositions, function (page) {\n        if (typeof callback !== 'undefined') {\n            callback(page);\n        }\n        selectedPage = page.pgNr;\n    });\n};\n\nDesignerPage.createNewPage = function (db, pageName, callback) {\n    var newPage = new DesignerObjects.PdfPage(db, pageName);\n    DesignerOfflineDB.addObject('pdf_pages', newPage, function (pgNr) {\n        newPage.pgNr = pgNr;\n        if (typeof callback !== 'undefined') {\n            callback(newPage);\n        }\n    });\n};\n\nDesignerPage.saveTablePositions = function (positions, callback) {\n    DesignerOfflineDB.addObject('table_coords', positions, callback);\n};\n\nDesignerPage.createPageList = function (db, callback) {\n    DesignerOfflineDB.loadAllObjects('pdf_pages', function (pages) {\n        var html = '';\n        for (var p = 0; p < pages.length; p++) {\n            var page = pages[p];\n            if (page.dbName === db) {\n                html += '<option value=\"' + page.pgNr + '\">';\n                html += Functions.escapeHtml(page.pageDescr) + '</option>';\n            }\n        }\n        if (typeof callback !== 'undefined') {\n            callback(html);\n        }\n    });\n};\n\nDesignerPage.deletePage = function (pageId, callback) {\n    DesignerOfflineDB.loadObject('pdf_pages', pageId, function (page) {\n        if (page) {\n            for (var i = 0; i < page.tblCords.length; i++) {\n                DesignerOfflineDB.deleteObject('table_coords', page.tblCords[i]);\n            }\n            DesignerOfflineDB.deleteObject('pdf_pages', pageId, callback);\n        }\n    });\n};\n\nDesignerPage.loadFirstPage = function (db, callback) {\n    DesignerOfflineDB.loadAllObjects('pdf_pages', function (pages) {\n        var firstPage = null;\n        for (var i = 0; i < pages.length; i++) {\n            var page = pages[i];\n            if (page.dbName === db) {\n                // give preference to a page having same name as the db\n                if (page.pageDescr === db) {\n                    callback(page);\n                    return;\n                }\n                if (firstPage === null) {\n                    firstPage = page;\n                }\n            }\n        }\n        callback(firstPage);\n    });\n};\n\nDesignerPage.showNewPageTables = function (check) {\n    var allTables = $('#id_scroll_tab').find('td input:checkbox');\n    allTables.prop('checked', check);\n    for (var tab = 0; tab < allTables.length; tab++) {\n        var input = allTables[tab];\n        if (input.value) {\n            var element = document.getElementById(input.value);\n            element.style.top = DesignerPage.getRandom(550, 20) + 'px';\n            element.style.left = DesignerPage.getRandom(700, 20) + 'px';\n            DesignerMove.visibleTab(input, input.value);\n        }\n    }\n    selectedPage = -1;\n    $('#page_name').text(Messages.strUntitled);\n    DesignerMove.markUnsaved();\n};\n\nDesignerPage.loadHtmlForPage = function (pageId) {\n    DesignerPage.showNewPageTables(true);\n    DesignerPage.loadPageObjects(pageId, function (page, tblCords) {\n        $('#name-panel').find('#page_name').text(page.pageDescr);\n        var tableMissing = false;\n        for (var t = 0; t < tblCords.length; t++) {\n            var tbId = db + '.' + tblCords[t].tableName;\n            var table = document.getElementById(tbId);\n            if (table === null) {\n                tableMissing = true;\n                continue;\n            }\n            table.style.top = tblCords[t].y + 'px';\n            table.style.left = tblCords[t].x + 'px';\n\n            var checkbox = document.getElementById('check_vis_' + tbId);\n            checkbox.checked = true;\n            DesignerMove.visibleTab(checkbox, checkbox.value);\n        }\n        DesignerMove.markSaved();\n        if (tableMissing === true) {\n            DesignerMove.markUnsaved();\n            Functions.ajaxShowMessage(Messages.strSavedPageTableMissing);\n        }\n        selectedPage = page.pgNr;\n    });\n};\n\nDesignerPage.loadPageObjects = function (pageId, callback) {\n    DesignerOfflineDB.loadObject('pdf_pages', pageId, function (page) {\n        var tblCords = [];\n        var count = page.tblCords.length;\n        for (var i = 0; i < count; i++) {\n            DesignerOfflineDB.loadObject('table_coords', page.tblCords[i], function (tblCord) {\n                tblCords.push(tblCord);\n                if (tblCords.length === count) {\n                    if (typeof callback !== 'undefined') {\n                        callback(page, tblCords);\n                    }\n                }\n            });\n        }\n    });\n};\n\nDesignerPage.getRandom = function (max, min) {\n    var val = Math.random() * (max - min) + min;\n    return Math.floor(val);\n};\n"],"names":["DesignerPage","showTablesInLandingPage","db","loadFirstPage","page","loadHtmlForPage","pgNr","selectedPage","showNewPageTables","saveToNewPage","pageName","tablePositions","callback","createNewPage","tblCords","saveCallback","id","push","length","DesignerOfflineDB","addObject","pos","pdfPgNr","saveTablePositions","saveToSelectedPage","pageId","deletePage","newPage","DesignerObjects","PdfPage","positions","createPageList","loadAllObjects","pages","html","p","dbName","Functions","escapeHtml","pageDescr","loadObject","i","deleteObject","firstPage","check","allTables","$","find","prop","tab","input","value","element","document","getElementById","style","top","getRandom","left","DesignerMove","visibleTab","text","Messages","strUntitled","markUnsaved","loadPageObjects","tableMissing","t","tbId","tableName","table","y","x","checkbox","checked","markSaved","ajaxShowMessage","strSavedPageTableMissing","count","tblCord","max","min","val","Math","random","floor"],"sourceRoot":""}