{"version":3,"file":"designer/database.js","mappings":"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","sources":["webpack://phpmyadmin/external var \"jQuery\"","webpack://phpmyadmin/./js/src/designer/database.js"],"sourcesContent":["module.exports = jQuery;","import { ajaxShowMessage } from '../modules/ajax-message.js';\n\nvar designerTables = [\n    {\n        name: 'pdf_pages',\n        key: 'pgNr',\n        autoIncrement: true\n    },\n    {\n        name: 'table_coords',\n        key: 'id',\n        autoIncrement: true\n    }\n];\n\nvar DesignerOfflineDB = (function () {\n    var designerDB = {};\n\n    /**\n     * @type {IDBDatabase|null}\n     */\n    var datastore = null;\n\n    /**\n     * @param {String} table\n     * @return {IDBTransaction}\n     */\n    designerDB.getTransaction = function (table) {\n        return datastore.transaction([table], 'readwrite');\n    };\n\n    /**\n     * @param {String} table\n     * @return {IDBObjectStore}\n     */\n    designerDB.getObjectStore = function (table) {\n        var transaction = designerDB.getTransaction(table);\n        var objStore = transaction.objectStore(table);\n        return objStore;\n    };\n\n    /**\n     * @param {IDBTransaction} transaction\n     * @param {String} table\n     * @return {IDBObjectStore}\n     */\n    designerDB.getCursorRequest = function (transaction, table) {\n        var objStore = transaction.objectStore(table);\n        var keyRange = IDBKeyRange.lowerBound(0);\n        var cursorRequest = objStore.openCursor(keyRange);\n        return cursorRequest;\n    };\n\n    /**\n     * @param {Function} callback\n     * @return {void}\n     */\n    designerDB.open = function (callback) {\n        var version = 1;\n        var request = window.indexedDB.open('pma_designer', version);\n\n        request.onupgradeneeded = function (e) {\n            var db = e.target.result;\n            e.target.transaction.onerror = designerDB.onerror;\n\n            var t;\n            for (t in designerTables) {\n                if (db.objectStoreNames.contains(designerTables[t].name)) {\n                    db.deleteObjectStore(designerTables[t].name);\n                }\n            }\n\n            for (t in designerTables) {\n                db.createObjectStore(designerTables[t].name, {\n                    keyPath: designerTables[t].key,\n                    autoIncrement: designerTables[t].autoIncrement\n                });\n            }\n        };\n\n        request.onsuccess = function (e) {\n            datastore = e.target.result;\n            if (typeof callback === 'function') {\n                callback(true);\n            }\n        };\n\n        request.onerror = function () {\n            ajaxShowMessage(window.Messages.strIndexedDBNotWorking, null, 'error');\n        };\n    };\n\n    /**\n     * @param {String} table\n     * @param {String} id\n     * @param {Function} callback\n     * @return {void}\n     */\n    designerDB.loadObject = function (table, id, callback) {\n        if (datastore === null) {\n            ajaxShowMessage(window.Messages.strIndexedDBNotWorking, null, 'error');\n            return;\n        }\n\n        var objStore = designerDB.getObjectStore(table);\n        var cursorRequest = objStore.get(parseInt(id));\n\n        cursorRequest.onsuccess = function (e) {\n            callback(e.target.result);\n        };\n\n        cursorRequest.onerror = designerDB.onerror;\n    };\n\n    /**\n     * @param {String} table\n     * @param {Function} callback\n     * @return {void}\n     */\n    designerDB.loadAllObjects = function (table, callback) {\n        if (datastore === null) {\n            ajaxShowMessage(window.Messages.strIndexedDBNotWorking, null, 'error');\n            return;\n        }\n\n        var transaction = designerDB.getTransaction(table);\n        var cursorRequest = designerDB.getCursorRequest(transaction, table);\n        var results = [];\n\n        transaction.oncomplete = function () {\n            callback(results);\n        };\n\n        cursorRequest.onsuccess = function (e) {\n            var result = e.target.result;\n            if (Boolean(result) === false) {\n                return;\n            }\n            results.push(result.value);\n            result.continue();\n        };\n\n        cursorRequest.onerror = designerDB.onerror;\n    };\n\n    /**\n     * @param {String} table\n     * @param {Function} callback\n     * @return {void}\n     */\n    designerDB.loadFirstObject = function (table, callback) {\n        if (datastore === null) {\n            ajaxShowMessage(window.Messages.strIndexedDBNotWorking, null, 'error');\n            return;\n        }\n\n        var transaction = designerDB.getTransaction(table);\n        var cursorRequest = designerDB.getCursorRequest(transaction, table);\n        var firstResult = null;\n\n        transaction.oncomplete = function () {\n            callback(firstResult);\n        };\n\n        cursorRequest.onsuccess = function (e) {\n            var result = e.target.result;\n            if (Boolean(result) === false) {\n                return;\n            }\n            firstResult = result.value;\n        };\n\n        cursorRequest.onerror = designerDB.onerror;\n    };\n\n    /**\n     * @param {String} table\n     * @param {Object} obj\n     * @param {Function} callback\n     * @return {void}\n     */\n    designerDB.addObject = function (table, obj, callback) {\n        if (datastore === null) {\n            ajaxShowMessage(window.Messages.strIndexedDBNotWorking, null, 'error');\n            return;\n        }\n\n        var objStore = designerDB.getObjectStore(table);\n        var request = objStore.put(obj);\n\n        request.onsuccess = function (e) {\n            if (typeof callback === 'function') {\n                callback(e.currentTarget.result);\n            }\n        };\n\n        request.onerror = designerDB.onerror;\n    };\n\n    /**\n     * @param {String} table\n     * @param {String} id\n     * @param {Function} callback\n     * @return {void}\n     */\n    designerDB.deleteObject = function (table, id, callback) {\n        if (datastore === null) {\n            ajaxShowMessage(window.Messages.strIndexedDBNotWorking, null, 'error');\n            return;\n        }\n\n        var objStore = designerDB.getObjectStore(table);\n        var request = objStore.delete(parseInt(id));\n\n        request.onsuccess = function () {\n            if (typeof callback === 'function') {\n                callback(true);\n            }\n        };\n\n        request.onerror = designerDB.onerror;\n    };\n\n    /**\n     * @param {Error} e\n     * @return {void}\n     */\n    designerDB.onerror = function (e) {\n        // eslint-disable-next-line no-console\n        console.log(e);\n    };\n\n    // Export the designerDB object.\n    return designerDB;\n}());\nwindow.DesignerOfflineDB = DesignerOfflineDB;\n"],"names":["ajaxShowMessage","designerTables","name","key","autoIncrement","DesignerOfflineDB","designerDB","datastore","getTransaction","table","transaction","getObjectStore","objStore","objectStore","getCursorRequest","keyRange","IDBKeyRange","lowerBound","cursorRequest","openCursor","open","callback","version","request","window","indexedDB","onupgradeneeded","e","db","target","result","onerror","t","objectStoreNames","contains","deleteObjectStore","createObjectStore","keyPath","onsuccess","Messages","strIndexedDBNotWorking","loadObject","id","get","parseInt","loadAllObjects","results","oncomplete","Boolean","push","value","continue","loadFirstObject","firstResult","addObject","obj","put","currentTarget","deleteObject","delete","console","log"],"sourceRoot":""}